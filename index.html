<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
		<meta name="description" content="" />
		<meta name="author" content="" />
		<!--[if IE]>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<![endif]-->
		<title>BOOTSTRAP CHAT EXAMPLE</title>
		<!-- BOOTSTRAP CORE STYLE CSS -->
		<title>Chat</title>
		<!--<link rel="stylesheet" href="/style.css">-->
		<!-- BOOTSTRAP CORE STYLE CSS -->
		<!-- BOOTSTRAP CORE STYLE CSS -->
		<link href="/bootstrap.min.css" rel="stylesheet" />
		<link href="/site.css" rel="stylesheet" />
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	</head>
	<body class="chat-body">
		<script>
		// Load the SDK asynchronously
		(function(thisdocument, scriptelement, id) {
		var js, fjs = thisdocument.getElementsByTagName(scriptelement)[0];
		if (thisdocument.getElementById(id)) return;

		js = thisdocument.createElement(scriptelement); js.id = id;
		js.src = "//connect.facebook.net/en_US/sdk.js"; //you can use 
		fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));
		</script>
		
		
		<div class="container">
			<div class="row ">
				<!-- <h3 class="text-center" >YouWall Chat </h3>
				<br /><br /> -->
				<div class="col-md-16">
					<div id="test" class="panel panel-info">
						<div class="panel-heading">
							RECENT CHAT HISTORY
						<	<button id="facebook" class="btn btn-sm btn-primary btn-block" onclick="login();" type="submit">Sign Up using Facebook</button>
						</div> 
						<div class="panel-body">
						<!-- <h2 id='joiners'> <i id='joined'>You </i> joined the chat!</h2> -->
							<ul class="media-list" id="messages"></ul>
						</div>
						<div class="panel-footer">
							<form action="">
							  <input id="m" autocomplete="off" />
							  <button>Send</button>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
					
		<!--<ul id="messages"></ul> -->
    
		
		
		<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.8.1.min.js"><\/script>')</script>
		<script src="/bootstrap.min.js"></script>
		<!--<script src="/underscore-min.js"></script>-->
		<!--<script src="https://code.jquery.com/jquery-1.11.3.js"></script>-->
		<script src="https://cdn.rawgit.com/ScottHamper/Cookies/1.2.1/dist/cookies.min.js"></script>
		<script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
		<script src="/client.js"></script>
	
		<script>
		
		window.fbAsyncInit = function() {
			FB.init({
			appId      : '1472854449685333', //Your APP ID
			cookie     : true,  // enable cookies to allow the server to access 
							// the session
			xfbml      : true,  // parse social plugins on this page
			version    : 'v2.1', // use version 2.1
			oauth: true
		});

		// These three cases are handled in the callback function.
		FB.getLoginStatus(function(response) {
		statusChangeCallback(response);
		});

		};
    
		// This is called with the results from from FB.getLoginStatus().
		function statusChangeCallback(response) {
			if (response.status === 'connected') {
			// Logged into your app and Facebook.
			_i();

			} else if (response.status === 'not_authorized') {
				// The person is logged into Facebook, but not your app.
				document.getElementById('status').innerHTML = 'Please log ' +
				'into this app.';
			}
		}  

		function login() {
			FB.login(function(response) {
			// handle the response
			if(response.status==='connected') {
			_i();
			}
			}, {scope: 'public_profile,email'});
		}

		function _i(){
			FB.api('/me', function(response) {
			var socket = io.connect('http://localhost:8080');
			console.log('response first: '+response.name);
			
			//	socket.emit('setNickname', {'username':response.name});
			//$('#facebook').hide();
			var username= response.name;
			FB.api('/'+response.id+'?fields=picture.width(20).height(20)', function(response){
			$("#profile_pic").attr("src",response.picture.data.url);
			var user = {name: username, avatar: response.picture.data.url};
			console.log("nome: "+user.name+" avatar: "+user.avatar);
			socket.emit('io:name', user);
			});
			//document.getElementById('status').innerHTML ='Thanks for logging in,' + response.name;
			//document.getElementById("inputFname").value = response.first_name;
			//document.getElementById("inputLname").value = response.last_name;
			//document.getElementById("inputEmail").value = response.email;
			});
		}


		function fbLogout() {
			var socket = io.connect('http://localhost:8888');
			FB.logout(function (response) {
			//Do what ever you want here when logged out like reloading the page
			window.location.reload();
			});
		}
		</script>
  </body>
</html>
